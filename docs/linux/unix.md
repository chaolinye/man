# Unix 和 Linux 教程

## 什么是 Linux？什么是 Unix?

Unix 是一种类型的计算机系统，而 Linux 是 Unix 系统一个特定家族的名称。

所有 Unix 操作系统都有两个重要的特征： 多任务和多用户。

> 当一个命名后面带个 `X`，可以想想是不是和 Unix 有关系

### 什么是内核

当计算机启动时，计算机要经历一系列的动作，这些动作构成引导过程。该过程的最后一个动作是启动一个非常复杂的程序，这个程序称为**内核(kernel) **。

内核的作用是控制计算机，充当操作系统的核心。由于这一点，所以内核总是一直运行

内核提供的服务：

- 内存管理（虚拟内存管理，包括分页）
- 进程管理（进程创建、终止、调度）
- 进程间通信（本地、网络）
- 输入输出（通过设备驱动程序，即实现与物理设备实际通信的程序）
- 文件管理
- 安全和访问控制
- 网络访问（如 TCP/IP)

内核可分为两大类：

- 单内核
    > 代表：Linux
    > 优点：速度快；缺点：难以设计和维护
- 微内核
    > 代表：FreeBSD
    > 优点：模块化设计，易于理解和维护，且更易于定制；缺点：比较慢

> Unix = 内核 + 实用工具

### Unix 的历史

![](../images/unix-history.png)

### Linux 发行版

Linus Torvalds 和 Linux 项目所创建的只是一个内核，并不是一个完整的操作系统。

要形成一个操作系统，需要为内核寻找所需的各种组件， 并将它们组装在一起。

而这个事情已经有很多团队在做了，基于 Linux 的操作系统成为 *Linux 发行版(distribution)*

大多数 Linux 发行版都使用自由软件基金会的 GNU 实用工具。基于这一原因 ， FSF 坚持基于 Linux 的操作系统实际上应该称为 `GNU/Linux`

> Linux 基于开放源代码运动编写的通用公共许可证(general publie lieense, GPL)

> 当在软件上应用 GPL 协议时，允许任何人发行该软件、查看其源代码、修改该软件并发行
修改后的软件。此外， GPL 协议要求任何重新发行软件（包括修改后的版本）的人，都不能
剥夺软件的使用自由或者添加自己的限制—~这是 GPL 的关键部分。

### BSD 发行版

BSD 是 20 世纪 80 年代两大 Unix 主流之一（ 另一个是 `System V`) 。 BSD由加利福尼亚大学伯克利分校计算机科学系开发。

BSD 在完全重写了 AT&T 的 UNIX 代码后，重新命名为 `FreeBSD`.

> Macbook 的 OS X 系统就是基于 FreeBSD 构建的

FreeBSD 只适用于 PC 端，为了能移植到其它类型计算机上，提供了 `NetBSD`

另外，还有一个主要关注安全和密码学的版本：`OpenBSD`

> BSD 许可证远没有 GPL 严格。在 BSD 许可证之下，允许使用部分 BSD 创建新产品而不共享该新产品。

> 因为 BSD 许可证的原因，企业更愿意基于 BSD 构建自己的商业操作系统。

Linux 比 FreeBSD 更成功的原因：

- Linux 基于 GNUGPL 名义发行，而 GNUGPL 协议鼓励共享。
- Linus Torvalds 在 1991 年发行了 Linux 内核，而 386/BSD 直到 1992 年才发行，所以 Linux 在发行时间上占得先机

## Unix 连接

可以通过下述两个简单的公式来描述所有的计算机系统：

- 计算机＝终端＋主机
- 终端=输入设施＋输出设施

Unix 的两种终端：

- 字符终端：只使用文本
- 图形终端

> Unix 的 GUI 都基于 一个称为 X Window 的系统，而且对 X Window 的基本支持 由 一个称为 X 终端的图形终端提供

> `ssh -X` 远程连接 GUI

## Unix 基础知识

> 关于 CRLF 换行符的由来: 之前输出终端主要是打印机，打印机换行需要两个动作打印机的托架回车(carriage return)，然后换行(linefeed)

> 为了安全，Unix 登录时不会提示用户不存在，而是提示登录错误，让攻击者不知道到底是用户名还是密码错误。

> 用户标识习惯上只使用小写字母。

注销的方法：`logout`、`exit`、`login`、`^D`

> ^ 代表 Ctrl。^D 一般绑定 eof 符号，在 shell 中输入 eof，代表没有新的命令了，shell 会自动退出

> `passwd` 改变口令

> `last` 查看所有用户的登录信息

## GUI

GUI 相对于文本界面(也称命令行界面，CLI)的优势之一：一次可以看到多个程序，程序之间的切换也很方便

X Window 是一个为使用图形数据的程序提供服务的系统。在 Unix 世界中 ， X Window 在 3 个方面非常重要。

> 通常称 X Window 为 X，最重要的发行版是 X11

1. 它是儿乎所有 GUI 的基础 。
2. X Window 允许在远程计算机上运行程序，井在自己的计算机上显示完整的图形输出．
3. X Window 使得使用各式各样的硬件成为可能。此外，还可以同时使用不止一台显示器。

X Window 被设计成 GUI 和硬件之间的标准化界面，本身并不提供图形界面，提供实际 GUI 的是 *窗口管理器（Window manager）*。

但是窗口管理器也就提供基本的图形界面，但也就提供最基础的功能，用户体验并不好，所以又出现更上层的桌面环境(Desktop Environment)，也称桌面管理器

Unix GUI 的抽象层次

![](../images/unix-gui.png)

Linux 系统最流行的两种桌面环境: `KDE`（Kool Desktop Environment） 和 `Gnome`(GNU Network Object Model Environment)

> KDE 的窗口管理器是 `kwm` , Gnome 的窗口管理器是 `Metacity`

> KDE 先出现，但是 GNU 觉得许可证不够自由，因此又创建了 Gnome

> KDE 更美观；Gnome 更简单。

> Gnome 用户喜欢控制事情如何运转， 而 KDE 用户喜欢控制事情的外观

## Unix 基础知识 2

### 多任务

Unix中的执行单元是进程。

> 进程就是装载到内存中准备运行的程序，以及程序的数据与跟踪程序状态所需的信息

Unix 的多任务并行是通过多个进程轮流使用处理器一段极短的时间来实现的，这一段极短的时间称为时间片(time slice) 。典型的时间片通常是 10 毫秒。

> 时间片的长短往往是动态的

### GUI

GUI 的菜单项的文本单词中往往会有一个字母有下划线，使用 ALT(accelerator) 加速键和这个字母可以快速选择菜单。

### 运行级别

典型的 Linux 运行级别：

| 运行级别 | 描述 |
| :--: | :--: |
| 0 | 停机（关机）|
| 1 | 单用户模式：命令行 |
| 2 | 非标准化 |
| 3 | 多用户模式: 命令行 |
| 4 | 非标准化 |
| 5 | 多用户模式: GUI |
| 6 | 重新启动 |

在大多数情况下， Linux 默认引导至运行级别 3 或者运行级别 5

系统维护时，系统管理员将重启 Unix 系统到运行级别 1（单用户模式，也就是所谓系统维护模式）

修改默认运行级别：修改 `/etc/inittab` 中的 `initdefault` 的值

临时修改 init

```bash
sudo init 6 # 等同于运行 reboot 命令，重启
sudo init 0 # 等同于运行 shutdowm now 命令，关机
```

> 这是老的服务管理 init 程序才能用的方法，新的服务管理程序 systemd 可以参考 [系统服务](http://localhost:3000/#/docs/linux/system-service?id=%e7%ae%a1%e7%90%86-target-unit) 章节

### 切换超级用户

su(substitute userid)命令允许您变换到另一个用户标识. 
sudo(substitdute the userid and do something)命令允许您以另一个用户标识的名义执行一条单独的命令．

> sudo 输入一次口令后，在一定时间内不必再次输入， 大多数系统的默认时间是 5 分钟

> 需要用户标识位于 /etc/sudoers 中才能使用 sudo 命令

### 系统启动或者停止时发生什么事情?

查看系统消息

```bash
dmesg | less
```

## Unix 键盘的使用

CLI 的使用方式有若干种。当使用自己的计算机时，可以使用虚拟控制台或者终端窗口（包括 Konsole 程序）。当使用远程主机时，可以通过 ssh 程序连接， ssh 程序将充当终端仿真器






## References

- [Unix & Linux 大学教程]()
