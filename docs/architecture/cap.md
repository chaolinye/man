# CAP 理论

在任意的分布式系统中，一致性(Consistency)、可用性(Availability)和分区容错性(Partition-tolerance)这三种属性最多只能同时存在两个属性

![](../images/cap.jpeg)

## 一致性

意思是，**写操作之后的读操作，无论访问哪个节点必须返回该值。**

!> 这里的一致性指的是强一致性

## 可用性

**无论哪个节点，只要收到用户的请求，服务器就必须给出回应。**

## 分区容错性

大多数分布式系统都分布在多个子网络。每个子网络就叫做一个区（partition）。

分区容错的意思是，**区间无法通信或者存在较大时延时，系统对外也能正常工作**

!> 一般来说，分区容错无法避免，系统设计都会保留 P 属性

## CAP 的矛盾

如果要保证一致性，那么节点1执行读操作时，就要锁住节点2的读写，等数据同步完成后再解锁，这段时间节点2就是不可用的

如果要保证可用性，那么势必不能锁着节点2，这段时间节点2的数据就不是不一致的

如果要保证可用性和一致性，节点2就得去访问节点1，这样就不允许分区通信出现失败

## 常见的选择

- CP 强一致性

- AP 可用性 + 最后一致性

## References

- [CAP 定理的含义](http://www.ruanyifeng.com/blog/2018/07/cap.html)

