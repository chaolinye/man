# 重构

## 为什么需要重构

- 重构改进软件设计：软件世界唯一不变的是变化，再好的设计也会被变化所破坏
- 软件虽然现在还可以运行，但如果不改它，不久后就会死去
- 软件是为业务服务的，业务不会给予太多的时间来优化代码
- 重构使软件更容易理解：代码也是个读多写少的场景，烂代码理解成本高，修改更容易引入bug
- 重构帮助找到 bug：重构的过程就是理解代码的过程，可助于找到遗漏的 bug
- 重构提高编程速度

## 重构的定义

重构是在不改变软件可观察行为的前提上，改善其内部结构的过程

重构（名词）：对软件内部结构的一种调整，目的是在不改变软件可观察行为的前提下，提高其可理解性，降低其修改成本

重构（动词）：使用一系列重构手法，在不改变软件可观察行为的前提下，调整其结构

## 重构之前

好的测试是重构的根本

重构之前，首先检查是否有一套可靠的测试机制，这些测试必须有自我检验能力

如果没有，则花时间建立要重构部分的测试机制

## 重构原则

两顶帽子：重构的帽子和添加功能的帽子，添加新功能的时候，不应该修改既有代码，只管添加新功能。重构时不能再添加功能，只管改进程序结构

最好不要在另一个对象的属性基础上运用 switch 语句

重构的节奏：测试、小修改、测试、小修改。。。

重构口诀：老的不变，新的创建，一步切换，老的再见

大多数重构都为程序引入了更多的间接层

## 重构和设计

简单设计，多想一步

考虑候选设计方案时，先问自己：将某个设计重构为另一个设计难不难？如果很简单，就选择最简单的设计

## 何时重构

时不过三，三则重构

- 添加功能时重构
    - 用重构来理解代码
    - 先重构让添加新功能更简单
- 修补错误时重构
    - 一眼看不出错误存在的地方往往就存在不清晰的代码
- 复审代码时重构

何时不该重构

- 重写比重构更简单
- 项目已近最后的期限

